"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const app = __importStar(require("./application"));
const configuration = __importStar(require("./configuration"));
const env_1 = require("./services/env");
const crypto_1 = require("crypto");
const got_1 = __importDefault(require("got"));
const buildGotErrorMessage_1 = __importDefault(require("./helpers/buildGotErrorMessage"));
const authentication_1 = require("./services/authentication");
const process_1 = require("process");
class MockMoovService {
    constructor() {
        this.parentService = null;
        this.FakeGetTranserData = (transferID) => {
            if (this.parentService) {
                return this.parentService.getTransferData(transferID);
            }
            return Promise.resolve(true);
        };
    }
    FakeCreateToken() {
        if (this.parentService) {
            return this.parentService.createToken();
        }
        return Promise.resolve(true);
    }
    getTransferData(transferID) {
        if (this.FakeGetTranserData != null) {
            return this.FakeGetTranserData(transferID);
        }
        return Promise.resolve(true);
    }
    createToken() {
        if (this.FakeCreateToken) {
            return this.FakeCreateToken();
        }
        return Promise.resolve({});
    }
}
const ReversedTransferPayload = {
    transferID: "ea96962b-cf0c-4409-9ef6-ead3aa7f619a",
    createdAt: "2022-05-13T14:35:15Z",
    createdOn: "2022-05-13T14:35:15Z",
    status: "reversed",
    amount: {
        currency: "USD",
        value: 100,
    },
    facilitatorFee: {
        total: 0,
    },
    source: {
        paymentMethodID: "5cc58d59-a79e-41ad-99f3-7e223ba99eaa",
        paymentMethodType: "ach-debit-fund",
        account: {
            accountID: "d4496693-cc50-466e-ab07-3974bfe7f4ac",
            email: "amanda@classbooker.dev",
            displayName: "Moov Financial",
        },
        bankAccount: {
            bankAccountID: "3abc682a-1523-45fb-9776-b14c058fcccf",
            fingerprint: "c22e13fc21f8006b40eb4e6bc215a5e05eff5d98c1136a1ed60890d66bc5c056",
            status: "verified",
            holderName: "Wic Noods",
            holderType: "individual",
            bankName: "VERIDIAN CREDIT UNION",
            bankAccountType: "checking",
            routingNumber: "273976369",
            lastFourAccountNumber: "4333",
        },
        ach: {
            status: "completed",
            traceNumber: "221475788687776",
        },
        achDetails: {
            status: "completed",
            traceNumber: "221475788687776",
        },
    },
    destination: {
        paymentMethodID: "ce0a27e7-5735-4432-a9c9-09c4d2082411",
        paymentMethodType: "moov-wallet",
        account: {
            accountID: "d4496693-cc50-466e-ab07-3974bfe7f4ac",
            email: "amanda@classbooker.dev",
            displayName: "Moov Financial",
        },
        wallet: {
            walletID: "35bce66e-c8f2-48ed-8fd0-c02bfd55e71a",
        },
    },
};
const CompletedTransferPayload = {
    transferID: "ea96962b-cf0c-4409-9ef6-ead3aa7f619a",
    createdAt: "2022-05-13T14:35:15Z",
    createdOn: "2022-05-13T14:35:15Z",
    status: "completed",
    amount: {
        currency: "USD",
        value: 200,
    },
    facilitatorFee: {
        total: 0,
    },
    source: {
        paymentMethodID: "5cc58d59-a79e-41ad-99f3-7e223ba99eaa",
        paymentMethodType: "ach-debit-fund",
        account: {
            accountID: "d4496693-cc50-466e-ab07-3974bfe7f4ac",
            email: "amanda@classbooker.dev",
            displayName: "Moov Financial",
        },
        bankAccount: {
            bankAccountID: "3abc682a-1523-45fb-9776-b14c058fcccf",
            fingerprint: "c22e13fc21f8006b40eb4e6bc215a5e05eff5d98c1136a1ed60890d66bc5c056",
            status: "verified",
            holderName: "Wic Noods",
            holderType: "individual",
            bankName: "VERIDIAN CREDIT UNION",
            bankAccountType: "checking",
            routingNumber: "273976369",
            lastFourAccountNumber: "4333",
        },
        ach: {
            status: "completed",
            traceNumber: "221475788687776",
        },
        achDetails: {
            status: "completed",
            traceNumber: "221475788687776",
        },
    },
    destination: {
        paymentMethodID: "ce0a27e7-5735-4432-a9c9-09c4d2082411",
        paymentMethodType: "moov-wallet",
        account: {
            accountID: "d4496693-cc50-466e-ab07-3974bfe7f4ac",
            email: "amanda@classbooker.dev",
            displayName: "Moov Financial",
        },
        wallet: {
            walletID: "35bce66e-c8f2-48ed-8fd0-c02bfd55e71a",
        },
    },
};
const PendingTransferPayload = {
    transferID: "ea96962b-cf0c-4409-9ef6-ead3aa7f619a",
    createdAt: "2022-05-13T14:35:15Z",
    createdOn: "2022-05-13T14:35:15Z",
    status: "pending",
    amount: {
        currency: "USD",
        value: 300,
    },
    facilitatorFee: {
        total: 0,
    },
    source: {
        paymentMethodID: "5cc58d59-a79e-41ad-99f3-7e223ba99eaa",
        paymentMethodType: "ach-debit-fund",
        account: {
            accountID: "d4496693-cc50-466e-ab07-3974bfe7f4ac",
            email: "amanda@classbooker.dev",
            displayName: "Moov Financial",
        },
        bankAccount: {
            bankAccountID: "3abc682a-1523-45fb-9776-b14c058fcccf",
            fingerprint: "c22e13fc21f8006b40eb4e6bc215a5e05eff5d98c1136a1ed60890d66bc5c056",
            status: "verified",
            holderName: "Wic Noods",
            holderType: "individual",
            bankName: "VERIDIAN CREDIT UNION",
            bankAccountType: "checking",
            routingNumber: "273976369",
            lastFourAccountNumber: "4333",
        },
        ach: {
            status: "completed",
            traceNumber: "221475788687776",
        },
        achDetails: {
            status: "completed",
            traceNumber: "221475788687776",
        },
    },
    destination: {
        paymentMethodID: "ce0a27e7-5735-4432-a9c9-09c4d2082411",
        paymentMethodType: "moov-wallet",
        account: {
            accountID: "d4496693-cc50-466e-ab07-3974bfe7f4ac",
            email: "amanda@classbooker.dev",
            displayName: "Moov Financial",
        },
        wallet: {
            walletID: "35bce66e-c8f2-48ed-8fd0-c02bfd55e71a",
        },
    },
};
const ReversedTransactionBody = {
    eventID: "97c9b100-de50-4463-8df0-1ec8457101be",
    type: "transfer.updated",
    data: {
        accountID: "a0967848-f494-4ff4-a309-9bfcd7ecbee0",
        transferID: "89fe1277-410f-4e86-9911-4722ec3974c9",
        status: "reversed",
        source: {},
        destination: {},
    },
    createdOn: "2022-05-13T15:49:03.459915084Z",
};
const CompletedTransactionBody = {
    eventID: "97c9b100-de50-4463-8df0-1ec8457101be",
    type: "transfer.updated",
    data: {
        accountID: "a0967848-f494-4ff4-a309-9bfcd7ecbee0",
        transferID: "89fe1277-410f-4e86-9911-4722ec3974c9",
        status: "completed",
        source: {},
        destination: {},
    },
    createdOn: "2022-05-13T15:49:03.459915084Z",
};
const CreatedTransactionBody = {
    eventID: "7d6da781-2f57-44f8-9ab0-5af69124a768",
    type: "transfer.created",
    data: {
        accountID: "d4496693-cc50-466e-ab07-3974bfe7f4ac",
        transferID: "71cd8493-27f5-4f59-8f9a-b7ccd04fcec2",
        status: "created",
    },
    createdOn: "2022-05-13T18:02:11.196621113Z",
};
async function SendTransaction(body) {
    await configuration.load();
    const config = configuration.active();
    const url = `http://localhost:${config.port}/webhooks`;
    const timestamp = new Date().toISOString();
    const nonce = (0, crypto_1.randomUUID)();
    const webhookID = (0, crypto_1.randomUUID)();
    const signature = (0, authentication_1.generateSignature)(timestamp, nonce, webhookID);
    try {
        const res = await (0, got_1.default)({
            url,
            method: "POST",
            headers: {
                "x-timestamp": timestamp,
                "x-nonce": nonce,
                "x-webhook-id": webhookID,
                "x-signature": signature,
            },
            json: body,
        });
        console.log(`Response: ${res.statusCode}`);
    }
    catch (err) {
        console.error(`sendTransferEvent failed: ${(0, buildGotErrorMessage_1.default)(err)}`);
        process.exit(1);
    }
}
async function Test(mockMoovService) {
    mockMoovService.FakeGetTranserData = async (transferID) => {
        let amount = (0, crypto_1.randomInt)(100000);
        ReversedTransferPayload.amount.value = amount;
        console.log(`Generating Reversed transaction of ${amount}`);
        return Promise.resolve(ReversedTransferPayload);
    };
    await SendTransaction(ReversedTransactionBody);
    mockMoovService.FakeGetTranserData = async (transferID) => {
        let amount = (0, crypto_1.randomInt)(100000);
        CompletedTransferPayload.amount.value = amount;
        console.log(`Generating Completed transaction of ${amount}`);
        return Promise.resolve(CompletedTransferPayload);
    };
    await SendTransaction(CompletedTransactionBody);
    mockMoovService.FakeGetTranserData = async (transferID) => {
        let amount = (0, crypto_1.randomInt)(100000);
        PendingTransferPayload.amount.value = amount;
        console.log(`Generating Pending transaction of ${amount}`);
        return Promise.resolve(PendingTransferPayload);
    };
    await SendTransaction(CreatedTransactionBody);
}
(async () => {
    try {
        process_1.env["MOOV_API_URL"] = "http://local.moov.io/api";
        let mockMoovService = new MockMoovService();
        env_1.Env.MoovService = mockMoovService;
        const config = await configuration.load();
        app.start(config).catch((err) => {
            console.error("Error loading server:" + err);
        });
        await Test(mockMoovService);
    }
    catch (err) {
        if (err) {
            console.error(err.message || err);
        }
    }
    //process.exit(1);
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy90ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLG1EQUFxQztBQUNyQywrREFBaUQ7QUFDakQsd0NBQXFDO0FBRXJDLG1DQUFxRDtBQUNyRCw4Q0FBb0M7QUFDcEMsMEZBQWtFO0FBQ2xFLDhEQUE4RDtBQUM5RCxxQ0FBOEI7QUFFOUIsTUFBTSxlQUFlO0lBQXJCO1FBQ0Usa0JBQWEsR0FBd0IsSUFBSSxDQUFDO1FBRTFDLHVCQUFrQixHQUFHLENBQUMsVUFBa0IsRUFBZ0IsRUFBRTtZQUN4RCxJQUFJLElBQUksQ0FBQyxhQUFhLEVBQUU7Z0JBQ3RCLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQyxlQUFlLENBQUMsVUFBVSxDQUFDLENBQUM7YUFDdkQ7WUFDRCxPQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDL0IsQ0FBQyxDQUFDO0lBcUJKLENBQUM7SUFuQkMsZUFBZTtRQUNiLElBQUksSUFBSSxDQUFDLGFBQWEsRUFBRTtZQUN0QixPQUFPLElBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxFQUFFLENBQUM7U0FDekM7UUFDRCxPQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDL0IsQ0FBQztJQUVELGVBQWUsQ0FBQyxVQUFrQjtRQUNoQyxJQUFJLElBQUksQ0FBQyxrQkFBa0IsSUFBSSxJQUFJLEVBQUU7WUFDbkMsT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUMsVUFBVSxDQUFDLENBQUM7U0FDNUM7UUFDRCxPQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDL0IsQ0FBQztJQUNELFdBQVc7UUFDVCxJQUFJLElBQUksQ0FBQyxlQUFlLEVBQUU7WUFDeEIsT0FBTyxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7U0FDL0I7UUFDRCxPQUFPLE9BQU8s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QUFDO1FBRWxDLE1BQU0sTUFBTSxHQUFHLE1BQU0sYUFBYSxDQUFDLElBQUksRUFBRSxDQUFDO1FBRTFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUU7WUFDOUIsT0FBTyxDQUFDLEtBQUssQ0FBQyx1QkFBdUIsR0FBRyxHQUFHLENBQUMsQ0FBQztRQUMvQyxDQUFDLENBQUMsQ0FBQztRQUVILE1BQU0sSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO0tBQzdCO0lBQUMsT0FBTyxHQUFRLEVBQUU7UUFDakIsSUFBSSxHQUFHLEVBQUU7WUFDUCxPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxPQUFPLElBQUksR0FBRyxDQUFDLENBQUM7U0FDbkM7S0FDRjtJQUVELGtCQUFrQjtBQUNwQixDQUFDLENBQUMsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgYXBwIGZyb20gXCIuL2FwcGxpY2F0aW9uXCI7XG5pbXBvcnQgKiBhcyBjb25maWd1cmF0aW9uIGZyb20gXCIuL2NvbmZpZ3VyYXRpb25cIjtcbmltcG9ydCB7IEVudiB9IGZyb20gXCIuL3NlcnZpY2VzL2VudlwiO1xuaW1wb3J0IHsgTW9vdlNlcnZpY2UsIElNb292U2VydmljZSwgTW9vdlRva2VuIH0gZnJvbSBcIi4vc2VydmljZXMvbW9vdlwiO1xuaW1wb3J0IHsgcmFuZG9tSW50LCByYW5kb21VVUlELCBzaWduIH0gZnJvbSBcImNyeXB0b1wiO1xuaW1wb3J0IGdvdCwgeyBSZXNwb25zZSB9IGZyb20gXCJnb3RcIjtcbmltcG9ydCBidWlsZEdvdEVycm9yTWVzc2FnZSBmcm9tIFwiLi9oZWxwZXJzL2J1aWxkR290RXJyb3JNZXNzYWdlXCI7XG5pbXBvcnQgeyBnZW5lcmF0ZVNpZ25hdHVyZSB9IGZyb20gXCIuL3NlcnZpY2VzL2F1dGhlbnRpY2F0aW9uXCI7XG5pbXBvcnQgeyBlbnYgfSBmcm9tIFwicHJvY2Vzc1wiO1xuXG5jbGFzcyBNb2NrTW9vdlNlcnZpY2UgaW1wbGVtZW50cyBJTW9vdlNlcnZpY2Uge1xuICBwYXJlbnRTZXJ2aWNlOiBJTW9vdlNlcnZpY2UgfCBudWxsID0gbnVsbDtcblxuICBGYWtlR2V0VHJhbnNlckRhdGEgPSAodHJhbnNmZXJJRDogc3RyaW5nKTogUHJvbWlzZTxhbnk+ID0+IHtcbiAgICBpZiAodGhpcy5wYXJlbnRTZXJ2aWNlKSB7XG4gICAgICByZXR1cm4gdGhpcy5wYXJlbnRTZXJ2aWNlLmdldFRyYW5zZmVyRGF0YSh0cmFuc2ZlcklEKTtcbiAgICB9XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0cnVlKTtcbiAgfTtcblxuICBGYWtlQ3JlYXRlVG9rZW4oKTogUHJvbWlzZTxhbnk+IHtcbiAgICBpZiAodGhpcy5wYXJlbnRTZXJ2aWNlKSB7XG4gICAgICByZXR1cm4gdGhpcy5wYXJlbnRTZXJ2aWNlLmNyZWF0ZVRva2VuKCk7XG4gICAgfVxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodHJ1ZSk7XG4gIH1cblxuICBnZXRUcmFuc2ZlckRhdGEodHJhbnNmZXJJRDogc3RyaW5nKTogUHJvbWlzZTxhbnk+IHtcbiAgICBpZiAodGhpcy5GYWtlR2V0VHJhbnNlckRhdGEgIT0gbnVsbCkge1xuICAgICAgcmV0dXJuIHRoaXMuRmFrZUdldFRyYW5zZXJEYXRhKHRyYW5zZmVySUQpO1xuICAgIH1cbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRydWUpO1xuICB9XG4gIGNyZWF0ZVRva2VuKCk6IFByb21pc2U8TW9vdlRva2VuPiB7XG4gICAgaWYgKHRoaXMuRmFrZUNyZWF0ZVRva2VuKSB7XG4gICAgICByZXR1cm4gdGhpcy5GYWtlQ3JlYXRlVG9rZW4oKTtcbiAgICB9XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7fSBhcyBNb292VG9rZW4pO1xuICB9XG59XG5cbmNvbnN0IFJldmVyc2VkVHJhbnNmZXJQYXlsb2FkID0ge1xuICB0cmFuc2ZlcklEOiBcImVhOTY5NjJiLWNmMGMtNDQwOS05ZWY2LWVhZDNhYTdmNjE5YVwiLFxuICBjcmVhdGVkQXQ6IFwiMjAyMi0wNS0xM1QxNDozNToxNVpcIixcbiAgY3JlYXRlZE9uOiBcIjIwMjItMDUtMTNUMTQ6MzU6MTVaXCIsXG4gIHN0YXR1czogXCJyZXZlcnNlZFwiLFxuICBhbW91bnQ6IHtcbiAgICBjdXJyZW5jeTogXCJVU0RcIixcbiAgICB2YWx1ZTogMTAwLFxuICB9LFxuICBmYWNpbGl0YXRvckZlZToge1xuICAgIHRvdGFsOiAwLFxuICB9LFxuICBzb3VyY2U6IHtcbiAgICBwYXltZW50TWV0aG9kSUQ6IFwiNWNjNThkNTktYTc5ZS00MWFkLTk5ZjMtN2UyMjNiYTk5ZWFhXCIsXG4gICAgcGF5bWVudE1ldGhvZFR5cGU6IFwiYWNoLWRlYml0LWZ1bmRcIixcbiAgICBhY2NvdW50OiB7XG4gICAgICBhY2NvdW50SUQ6IFwiZDQ0OTY2OTMtY2M1MC00NjZlLWFiMDctMzk3NGJmZTdmNGFjXCIsXG4gICAgICBlbWFpbDogXCJhbWFuZGFAY2xhc3Nib29rZXIuZGV2XCIsXG4gICAgICBkaXNwbGF5TmFtZTogXCJNb292IEZpbmFuY2lhbFwiLFxuICAgIH0sXG4gICAgYmFua0FjY291bnQ6IHtcbiAgICAgIGJhbmtBY2NvdW50SUQ6IFwiM2FiYzY4MmEtMTUyMy00NWZiLTk3NzYtYjE0YzA1OGZjY2NmXCIsXG4gICAgICBmaW5nZXJwcmludDogXCJjMjJlMTNmYzIxZjgwMDZiNDBlYjRlNmJjMjE1YTVlMDVlZmY1ZDk4YzExMzZhMWVkNjA4OTBkNjZiYzVjMDU2XCIsXG4gICAgICBzdGF0dXM6IFwidmVyaWZpZWRcIixcbiAgICAgIGhvbGRlck5hbWU6IFwiV2ljIE5vb2RzXCIsXG4gICAgICBob2xkZXJUeXBlOiBcImluZGl2aWR1YWxcIixcbiAgICAgIGJhbmtOYW1lOiBcIlZFUklESUFOIENSRURJVCBVTklPTlwiLFxuICAgICAgYmFua0FjY291bnRUeXBlOiBcImNoZWNraW5nXCIsXG4gICAgICByb3V0aW5nTnVtYmVyOiBcIjI3Mzk3NjM2OVwiLFxuICAgICAgbGFzdEZvdXJBY2NvdW50TnVtYmVyOiBcIjQzMzNcIixcbiAgICB9LFxuICAgIGFjaDoge1xuICAgICAgc3RhdHVzOiBcImNvbXBsZXRlZFwiLFxuICAgICAgdHJhY2VOdW1iZXI6IFwiMjIxNDc1Nzg4Njg3Nzc2XCIsXG4gICAgfSxcbiAgICBhY2hEZXRhaWxzOiB7XG4gICAgICBzdGF0dXM6IFwiY29tcGxldGVkXCIsXG4gICAgICB0cmFjZU51bWJlcjogXCIyMjE0NzU3ODg2ODc3NzZcIixcbiAgICB9LFxuICB9LFxuICBkZXN0aW5hdGlvbjoge1xuICAgIHBheW1lbnRNZXRob2RJRDogXCJjZTBhMjdlNy01NzM1LTQ0MzItYTljOS0wOWM0ZDIwODI0MTFcIixcbiAgICBwYXltZW50TWV0aG9kVHlwZTogXCJtb292LXdhbGxldFwiLFxuICAgIGFjY291bnQ6IHtcbiAgICAgIGFjY291bnRJRDogXCJkNDQ5NjY5My1jYzUwLTQ2NmUtYWIwNy0zOTc0YmZlN2Y0YWNcIixcbiAgICAgIGVtYWlsOiBcImFtYW5kYUBjbGFzc2Jvb2tlci5kZXZcIixcbiAgICAgIGRpc3BsYXlOYW1lOiBcIk1vb3YgRmluYW5jaWFsXCIsXG4gICAgfSxcbiAgICB3YWxsZXQ6IHtcbiAgICAgIHdhbGxldElEOiBcIjM1YmNlNjZlLWM4ZjItNDhlZC04ZmQwLWMwMmJmZDU1ZTcxYVwiLFxuICAgIH0sXG4gIH0sXG59O1xuXG5jb25zdCBDb21wbGV0ZWRUcmFuc2ZlclBheWxvYWQgPSB7XG4gIHRyYW5zZmVySUQ6IFwiZWE5Njk2MmItY2YwYy00NDA5LTllZjYtZWFkM2FhN2Y2MTlhXCIsXG4gIGNyZWF0ZWRBdDogXCIyMDIyLTA1LTEzVDE0OjM1OjE1WlwiLFxuICBjcmVhdGVkT246IFwiMjAyMi0wNS0xM1QxNDozNToxNVpcIixcbiAgc3RhdHVzOiBcImNvbXBsZXRlZFwiLFxuICBhbW91bnQ6IHtcbiAgICBjdXJyZW5jeTogXCJVU0RcIixcbiAgICB2YWx1ZTogMjAwLFxuICB9LFxuICBmYWNpbGl0YXRvckZlZToge1xuICAgIHRvdGFsOiAwLFxuICB9LFxuICBzb3VyY2U6IHtcbiAgICBwYXltZW50TWV0aG9kSUQ6IFwiNWNjNThkNTktYTc5ZS00MWFkLTk5ZjMtN2UyMjNiYTk5ZWFhXCIsXG4gICAgcGF5bWVudE1ldGhvZFR5cGU6IFwiYWNoLWRlYml0LWZ1bmRcIixcbiAgICBhY2NvdW50OiB7XG4gICAgICBhY2NvdW50SUQ6IFwiZDQ0OTY2OTMtY2M1MC00NjZlLWFiMDctMzk3NGJmZTdmNGFjXCIsXG4gICAgICBlbWFpbDogXCJhbWFuZGFAY2xhc3Nib29rZXIuZGV2XCIsXG4gICAgICBkaXNwbGF5TmFtZTogXCJNb292IEZpbmFuY2lhbFwiLFxuICAgIH0sXG4gICAgYmFua0FjY291bnQ6IHtcbiAgICAgIGJhbmtBY2NvdW50SUQ6IFwiM2FiYzY4MmEtMTUyMy00NWZiLTk3NzYtYjE0YzA1OGZjY2NmXCIsXG4gICAgICBmaW5nZXJwcmludDogXCJjMjJlMTNmYzIxZjgwMDZiNDBlYjRlNmJjMjE1YTVlMDVlZmY1ZDk4YzExMzZhMWVkNjA4OTBkNjZiYzVjMDU2XCIsXG4gICAgICBzdGF0dXM6IFwidmVyaWZpZWRcIixcbiAgICAgIGhvbGRlck5hbWU6IFwiV2ljIE5vb2RzXCIsXG4gICAgICBob2xkZXJUeXBlOiBcImluZGl2aWR1YWxcIixcbiAgICAgIGJhbmtOYW1lOiBcIlZFUklESUFOIENSRURJVCBVTklPTlwiLFxuICAgICAgYmFua0FjY291bnRUeXBlOiBcImNoZWNraW5nXCIsXG4gICAgICByb3V0aW5nTnVtYmVyOiBcIjI3Mzk3NjM2OVwiLFxuICAgICAgbGFzdEZvdXJBY2NvdW50TnVtYmVyOiBcIjQzMzNcIixcbiAgICB9LFxuICAgIGFjaDoge1xuICAgICAgc3RhdHVzOiBcImNvbXBsZXRlZFwiLFxuICAgICAgdHJhY2VOdW1iZXI6IFwiMjIxNDc1Nzg4Njg3Nzc2XCIsXG4gICAgfSxcbiAgICBhY2hEZXRhaWxzOiB7XG4gICAgICBzdGF0dXM6IFwiY29tcGxldGVkXCIsXG4gICAgICB0cmFjZU51bWJlcjogXCIyMjE0NzU3ODg2ODc3NzZcIixcbiAgICB9LFxuICB9LFxuICBkZXN0aW5hdGlvbjoge1xuICAgIHBheW1lbnRNZXRob2RJRDogXCJjZTBhMjdlNy01NzM1LTQ0MzItYTljOS0wOWM0ZDIwODI0MTFcIixcbiAgICBwYXltZW50TWV0aG9kVHlwZTogXCJtb292LXdhbGxldFwiLFxuICAgIGFjY291bnQ6IHtcbiAgICAgIGFjY291bnRJRDogXCJkNDQ5NjY5My1jYzUwLTQ2NmUtYWIwNy0zOTc0YmZlN2Y0YWNcIixcbiAgICAgIGVtYWlsOiBcImFtYW5kYUBjbGFzc2Jvb2tlci5kZXZcIixcbiAgICAgIGRpc3BsYXlOYW1lOiBcIk1vb3YgRmluYW5jaWFsXCIsXG4gICAgfSxcbiAgICB3YWxsZXQ6IHtcbiAgICAgIHdhbGxldElEOiBcIjM1YmNlNjZlLWM4ZjItNDhlZC04ZmQwLWMwMmJmZDU1ZTcxYVwiLFxuICAgIH0sXG4gIH0sXG59O1xuXG5jb25zdCBQZW5kaW5nVHJhbnNmZXJQYXlsb2FkID0ge1xuICB0cmFuc2ZlcklEOiBcImVhOTY5NjJiLWNmMGMtNDQwOS05ZWY2LWVhZDNhYTdmNjE5YVwiLFxuICBjcmVhdGVkQXQ6IFwiMjAyMi0wNS0xM1QxNDozNToxNVpcIixcbiAgY3JlYXRlZE9uOiBcIjIwMjItMDUtMTNUMTQ6MzU6MTVaXCIsXG4gIHN0YXR1czogXCJwZW5kaW5nXCIsXG4gIGFtb3VudDoge1xuICAgIGN1cnJlbmN5OiBcIlVTRFwiLFxuICAgIHZhbHVlOiAzMDAsXG4gIH0sXG4gIGZhY2lsaXRhdG9yRmVlOiB7XG4gICAgdG90YWw6IDAsXG4gIH0sXG4gIHNvdXJjZToge1xuICAgIHBheW1lbnRNZXRob2RJRDogXCI1Y2M1OGQ1OS1hNzllLTQxYWQtOTlmMy03ZTIyM2JhOTllYWFcIixcbiAgICBwYXltZW50TWV0aG9kVHlwZTogXCJhY2gtZGViaXQtZnVuZFwiLFxuICAgIGFjY291bnQ6IHtcbiAgICAgIGFjY291bnRJRDogXCJkNDQ5NjY5My1jYzUwLTQ2NmUtYWIwNy0zOTc0YmZlN2Y0YWNcIixcbiAgICAgIGVtYWlsOiBcImFtYW5kYUBjbGFzc2Jvb2tlci5kZXZcIixcbiAgICAgIGRpc3BsYXlOYW1lOiBcIk1vb3YgRmluYW5jaWFsXCIsXG4gICAgfSxcbiAgICBiYW5rQWNjb3VudDoge1xuICAgICAgYmFua0FjY291bnRJRDogXCIzYWJjNjgyYS0xNTIzLTQ1ZmItOTc3Ni1iMTRjMDU4ZmNjY2ZcIixcbiAgICAgIGZpbmdlcnByaW50OiBcImMyMmUxM2ZjMjFmODAwNmI0MGViNGU2YmMyMTVhNWUwNWVmZjVkOThjMTEzNmExZWQ2MDg5MGQ2NmJjNWMwNTZcIixcbiAgICAgIHN0YXR1czogXCJ2ZXJpZmllZFwiLFxuICAgICAgaG9sZGVyTmFtZTogXCJXaWMgTm9vZHNcIixcbiAgICAgIGhvbGRlclR5cGU6IFwiaW5kaXZpZHVhbFwiLFxuICAgICAgYmFua05hbWU6IFwiVkVSSURJQU4gQ1JFRElUIFVOSU9OXCIsXG4gICAgICBiYW5rQWNjb3VudFR5cGU6IFwiY2hlY2tpbmdcIixcbiAgICAgIHJvdXRpbmdOdW1iZXI6IFwiMjczOTc2MzY5XCIsXG4gICAgICBsYXN0Rm91ckFjY291bnROdW1iZXI6IFwiNDMzM1wiLFxuICAgIH0sXG4gICAgYWNoOiB7XG4gICAgICBzdGF0dXM6IFwiY29tcGxldGVkXCIsXG4gICAgICB0cmFjZU51bWJlcjogXCIyMjE0NzU3ODg2ODc3NzZcIixcbiAgICB9LFxuICAgIGFjaERldGFpbHM6IHtcbiAgICAgIHN0YXR1czogXCJjb21wbGV0ZWRcIixcbiAgICAgIHRyYWNlTnVtYmVyOiBcIjIyMTQ3NTc4ODY4Nzc3NlwiLFxuICAgIH0sXG4gIH0sXG4gIGRlc3RpbmF0aW9uOiB7XG4gICAgcGF5bWVudE1ldGhvZElEOiBcImNlMGEyN2U3LTU3MzUtNDQzMi1hOWM5LTA5YzRkMjA4MjQxMVwiLFxuICAgIHBheW1lbnRNZXRob2RUeXBlOiBcIm1vb3Ytd2FsbGV0XCIsXG4gICAgYWNjb3VudDoge1xuICAgICAgYWNjb3VudElEOiBcImQ0NDk2NjkzLWNjNTAtNDY2ZS1hYjA3LTM5NzRiZmU3ZjRhY1wiLFxuICAgICAgZW1haWw6IFwiYW1hbmRhQGNsYXNzYm9va2VyLmRldlwiLFxuICAgICAgZGlzcGxheU5hbWU6IFwiTW9vdiBGaW5hbmNpYWxcIixcbiAgICB9LFxuICAgIHdhbGxldDoge1xuICAgICAgd2FsbGV0SUQ6IFwiMzViY2U2NmUtYzhmMi00OGVkLThmZDAtYzAyYmZkNTVlNzFhXCIsXG4gICAgfSxcbiAgfSxcbn07XG5cbmNvbnN0IFJldmVyc2VkVHJhbnNhY3Rpb25Cb2R5ID0ge1xuICBldmVudElEOiBcIjk3YzliMTAwLWRlNTAtNDQ2My04ZGYwLTFlYzg0NTcxMDFiZVwiLFxuICB0eXBlOiBcInRyYW5zZmVyLnVwZGF0ZWRcIixcbiAgZGF0YToge1xuICAgIGFjY291bnRJRDogXCJhMDk2Nzg0OC1mNDk0LTRmZjQtYTMwOS05YmZjZDdlY2JlZTBcIixcbiAgICB0cmFuc2ZlcklEOiBcIjg5ZmUxMjc3LTQxMGYtNGU4Ni05OTExLTQ3MjJlYzM5NzRjOVwiLFxuICAgIHN0YXR1czogXCJyZXZlcnNlZFwiLFxuICAgIHNvdXJjZToge30sXG4gICAgZGVzdGluYXRpb246IHt9LFxuICB9LFxuICBjcmVhdGVkT246IFwiMjAyMi0wNS0xM1QxNTo0OTowMy40NTk5MTUwODRaXCIsXG59O1xuXG5jb25zdCBDb21wbGV0ZWRUcmFuc2FjdGlvbkJvZHkgPSB7XG4gIGV2ZW50SUQ6IFwiOTdjOWIxMDAtZGU1MC00NDYzLThkZjAtMWVjODQ1NzEwMWJlXCIsXG4gIHR5cGU6IFwidHJhbnNmZXIudXBkYXRlZFwiLFxuICBkYXRhOiB7XG4gICAgYWNjb3VudElEOiBcImEwOTY3ODQ4LWY0OTQtNGZmNC1hMzA5LTliZmNkN2VjYmVlMFwiLFxuICAgIHRyYW5zZmVySUQ6IFwiODlmZTEyNzctNDEwZi00ZTg2LTk5MTEtNDcyMmVjMzk3NGM5XCIsXG4gICAgc3RhdHVzOiBcImNvbXBsZXRlZFwiLFxuICAgIHNvdXJjZToge30sXG4gICAgZGVzdGluYXRpb246IHt9LFxuICB9LFxuICBjcmVhdGVkT246IFwiMjAyMi0wNS0xM1QxNTo0OTowMy40NTk5MTUwODRaXCIsXG59XG5cbmNvbnN0IENyZWF0ZWRUcmFuc2FjdGlvbkJvZHkgPSAge1xuICBldmVudElEOiBcIjdkNmRhNzgxLTJmNTctNDRmOC05YWIwLTVhZjY5MTI0YTc2OFwiLFxuICB0eXBlOiBcInRyYW5zZmVyLmNyZWF0ZWRcIixcbiAgZGF0YToge1xuICAgIGFjY291bnRJRDogXCJkNDQ5NjY5My1jYzUwLTQ2NmUtYWIwNy0zOTc0YmZlN2Y0YWNcIixcbiAgICB0cmFuc2ZlcklEOiBcIjcxY2Q4NDkzLTI3ZjUtNGY1OS04ZjlhLWI3Y2NkMDRmY2VjMlwiLFxuICAgIHN0YXR1czogXCJjcmVhdGVkXCIsXG4gIH0sXG4gIGNyZWF0ZWRPbjogXCIyMDIyLTA1LTEzVDE4OjAyOjExLjE5NjYyMTExM1pcIixcbn1cblxuYXN5bmMgZnVuY3Rpb24gU2VuZFRyYW5zYWN0aW9uKGJvZHk6IGFueSk6IFByb21pc2U8YW55PiB7XG4gIGF3YWl0IGNvbmZpZ3VyYXRpb24ubG9hZCgpO1xuICBjb25zdCBjb25maWcgPSBjb25maWd1cmF0aW9uLmFjdGl2ZSgpO1xuICBjb25zdCB1cmwgPSBgaHR0cDovL2xvY2FsaG9zdDoke2NvbmZpZy5wb3J0fS93ZWJob29rc2A7XG5cbiAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICBjb25zdCBub25jZSA9IHJhbmRvbVVVSUQoKTtcbiAgY29uc3Qgd2ViaG9va0lEID0gcmFuZG9tVVVJRCgpO1xuICBjb25zdCBzaWduYXR1cmUgPSBnZW5lcmF0ZVNpZ25hdHVyZSh0aW1lc3RhbXAsIG5vbmNlLCB3ZWJob29rSUQpO1xuXG4gIHRyeSB7XG4gICAgY29uc3QgcmVzOiBSZXNwb25zZSA9IGF3YWl0IGdvdCh7XG4gICAgICB1cmwsXG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICBcIngtdGltZXN0YW1wXCI6IHRpbWVzdGFtcCxcbiAgICAgICAgXCJ4LW5vbmNlXCI6IG5vbmNlLFxuICAgICAgICBcIngtd2ViaG9vay1pZFwiOiB3ZWJob29rSUQsXG4gICAgICAgIFwieC1zaWduYXR1cmVcIjogc2lnbmF0dXJlLFxuICAgICAgfSxcbiAgICAgIGpzb246IGJvZHksXG4gICAgfSk7XG4gICAgY29uc29sZS5sb2coYFJlc3BvbnNlOiAke3Jlcy5zdGF0dXNDb2RlfWApO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBjb25zb2xlLmVycm9yKGBzZW5kVHJhbnNmZXJFdmVudCBmYWlsZWQ6ICR7YnVpbGRHb3RFcnJvck1lc3NhZ2UoZXJyKX1gKTtcbiAgICBwcm9jZXNzLmV4aXQoMSk7XG4gIH1cbn1cblxuXG5hc3luYyBmdW5jdGlvbiBUZXN0KG1vY2tNb292U2VydmljZTogTW9ja01vb3ZTZXJ2aWNlKSB7XG4gIG1vY2tNb292U2VydmljZS5GYWtlR2V0VHJhbnNlckRhdGEgPSBhc3luYyAodHJhbnNmZXJJRDogc3RyaW5nKSA9PiB7XG4gICAgbGV0IGFtb3VudCA9IHJhbmRvbUludCgxMDAwMDApXG4gICAgUmV2ZXJzZWRUcmFuc2ZlclBheWxvYWQuYW1vdW50LnZhbHVlID0gYW1vdW50XG4gICAgY29uc29sZS5sb2coYEdlbmVyYXRpbmcgUmV2ZXJzZWQgdHJhbnNhY3Rpb24gb2YgJHthbW91bnR9YClcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKFJldmVyc2VkVHJhbnNmZXJQYXlsb2FkKTtcbiAgfTtcblxuICBhd2FpdCBTZW5kVHJhbnNhY3Rpb24oUmV2ZXJzZWRUcmFuc2FjdGlvbkJvZHkpO1xuXG4gIG1vY2tNb292U2VydmljZS5GYWtlR2V0VHJhbnNlckRhdGEgPSBhc3luYyAodHJhbnNmZXJJRDogc3RyaW5nKSA9PiB7XG4gICAgbGV0IGFtb3VudCA9IHJhbmRvbUludCgxMDAwMDApXG4gICAgQ29tcGxldGVkVHJhbnNmZXJQYXlsb2FkLmFtb3VudC52YWx1ZSA9IGFtb3VudFxuICAgIGNvbnNvbGUubG9nKGBHZW5lcmF0aW5nIENvbXBsZXRlZCB0cmFuc2FjdGlvbiBvZiAke2Ftb3VudH1gKVxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoQ29tcGxldGVkVHJhbnNmZXJQYXlsb2FkKTtcbiAgfTtcblxuICBhd2FpdCBTZW5kVHJhbnNhY3Rpb24oQ29tcGxldGVkVHJhbnNhY3Rpb25Cb2R5KTtcblxuICBtb2NrTW9vdlNlcnZpY2UuRmFrZUdldFRyYW5zZXJEYXRhID0gYXN5bmMgKHRyYW5zZmVySUQ6IHN0cmluZykgPT4ge1xuICAgIGxldCBhbW91bnQgPSByYW5kb21JbnQoMTAwMDAwKVxuICAgIFBlbmRpbmdUcmFuc2ZlclBheWxvYWQuYW1vdW50LnZhbHVlID0gYW1vdW50XG4gICAgY29uc29sZS5sb2coYEdlbmVyYXRpbmcgUGVuZGluZyB0cmFuc2FjdGlvbiBvZiAke2Ftb3VudH1gKVxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoUGVuZGluZ1RyYW5zZmVyUGF5bG9hZCk7XG4gIH07XG5cbiAgYXdhaXQgU2VuZFRyYW5zYWN0aW9uKENyZWF0ZWRUcmFuc2FjdGlvbkJvZHkpO1xufVxuXG4oYXN5bmMgKCkgPT4ge1xuICB0cnkge1xuICAgIGVudltcIk1PT1ZfQVBJX1VSTFwiXSA9IFwiaHR0cDovL2xvY2FsLm1vb3YuaW8vYXBpXCI7XG5cbiAgICBsZXQgbW9ja01vb3ZTZXJ2aWNlID0gbmV3IE1vY2tNb292U2VydmljZSgpO1xuXG4gICAgRW52Lk1vb3ZTZXJ2aWNlID0gbW9ja01vb3ZTZXJ2aWNlO1xuXG4gICAgY29uc3QgY29uZmlnID0gYXdhaXQgY29uZmlndXJhdGlvbi5sb2FkKCk7XG5cbiAgICBhcHAuc3RhcnQoY29uZmlnKS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgbG9hZGluZyBzZXJ2ZXI6XCIgKyBlcnIpO1xuICAgIH0pO1xuXG4gICAgYXdhaXQgVGVzdChtb2NrTW9vdlNlcnZpY2UpO1xuICB9IGNhdGNoIChlcnI6IGFueSkge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyLm1lc3NhZ2UgfHwgZXJyKTtcbiAgICB9XG4gIH1cblxuICAvL3Byb2Nlc3MuZXhpdCgxKTtcbn0pKCk7XG4iXX0=